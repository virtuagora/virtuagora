(function(e,t,n){"use strict";var r={html:"<!DOCTYPE html>"+"<html>"+"<head>"+"<style>.ie * {min-height: auto !important}</style>"+'<meta http-equiv="Content-Type" content="text/html;charset={charset}" />'+'<link rel="stylesheet" type="text/css" href="{style}" />'+"</head>"+'<body contenteditable="true" {spellcheck}></body>'+"</html>",toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><i class="fa {icon}"></i></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> '+'<textarea cols="20" rows="7" id="txt"></textarea></div>'+'<div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div>'+'<div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div>'+'<div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" value="http://" /></div>'+'<div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div>'+'<div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div>'+'<div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div>'+'<div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" value="http://" /></div>'+'<div><label for="des">{desc}</label> <input type="text" id="des" /></div>'+'<div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" value="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="//www.youtube.com/embed/{id}" frameborder="0" allowfullscreen></iframe>'};var i=function(t,n,i){var s=r[t];e.each(n,function(e,t){s=s.replace(new RegExp("\\{"+e+"\\}","g"),t)});if(i)s=e(s);return s};e.sceditor=function(r,s){var o=this;var u=r.get?r.get(0):r;var a=e(u);var f;var l;var c;var h;var p;var d;var v;var m;var g;var y=[];var b;var w;var E=[];var S;var x=[];var T=[];var N;var C;var k;var L;var A;var O;var M;var _;var D={};var P=[];var H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt;o.commands=e.extend(true,{},s.commands||e.sceditor.commands);o.opts=s=e.extend({},e.sceditor.defaultOptions,s);H=function(){a.data("sceditor",o);e.each(s,function(t,n){if(e.isPlainObject(n))s[t]=e.extend(true,{},n)});if(s.locale&&s.locale!=="en")R();f=e('<div class="sceditor-container" />').insertAfter(a).css("z-index",s.zIndex);if(e.sceditor.ie)f.addClass("ie ie"+e.sceditor.ie);M=!!a.attr("required");a.removeAttr("required");q();J();U();I();X();z();W();if(!e.sceditor.isWysiwygSupported)o.toggleSourceMode();var r=function(){e(t).unbind("load",r);if(s.autofocus)ht();if(s.autoExpand)o.expandToContent();st()};e(t).load(r);if(n.readyState&&n.readyState==="complete")r();ut();C.call("ready")};q=function(){var t=s.plugins;t=t?t.toString().split(","):[];C=new e.sceditor.PluginManager(o);e.each(t,function(t,n){C.register(e.trim(n))})};R=function(){var t;if(e.sceditor.locale[s.locale])w=e.sceditor.locale[s.locale];else{t=s.locale.split("-");if(e.sceditor.locale[t[0]])w=e.sceditor.locale[t[0]]}if(w&&w.dateFormat)s.dateFormat=w.dateFormat};I=function(){var n,r;v=e("<textarea></textarea>").hide();c=e('<iframe frameborder="0"></iframe>');if(!s.spellcheck)v.attr("spellcheck","false");if(t.location.protocol==="https:")c.attr("src","javascript:false");f.append(c).append(v);h=c[0];m=v[0];o.width(s.width||a.width());o.height(s.height||a.height());n=K();n.open();n.write(i("html",{spellcheck:s.spellcheck?"":'spellcheck="false"',charset:s.charset,style:s.style}));n.close();d=e(n);p=e(n.body);o.readOnly(!!s.readOnly);if(e.sceditor.ie)d.find("html").addClass("ie ie"+e.sceditor.ie);if(e.sceditor.ios||e.sceditor.ie){p.height("100%");if(!e.sceditor.ie)p.bind("touchend",o.focus)}S=new e.sceditor.rangeHelper(h.contentWindow);o.val(a.hide().val());r=a.attr("tabindex");v.attr("tabindex",r);c.attr("tabindex",r)};z=function(){if(s.autoUpdate){p.bind("blur",o.updateOriginal);v.bind("blur",o.updateOriginal)}if(s.rtl===null)s.rtl=v.css("direction")==="rtl";o.rtl(!!s.rtl);if(s.autoExpand)d.bind("keyup",o.expandToContent);if(s.resizeEnabled)V();f.attr("id",s.id);o.emoticons(s.emoticonsEnabled)};W=function(){e(n).click(it);e(u.form).bind("reset",tt).submit(o.updateOriginal);e(t).bind("resize orientationChanged",st);p.keypress(et).keydown(Y).keydown(Z).keyup(ft).bind("paste",Q).bind(e.sceditor.ie?"selectionchange":"keyup focus blur contextmenu mouseup touchend click",lt).bind("keydown keyup keypress focus blur contextmenu",rt);if(s.emoticonsCompat&&t.getSelection)p.keyup(dt);v.bind("keydown keyup keypress focus blur contextmenu",rt).keydown(Y);d.keypress(et).mousedown(nt).bind(e.sceditor.ie?"selectionchange":"focus blur contextmenu mouseup click",lt).bind("beforedeactivate keyup",F).keyup(ft).focus(function(){b=null});f.bind("selectionchanged",ct).bind("selectionchanged",ut).bind("selectionchanged",rt).bind("nodechanged",rt)};U=function(){var t,n,r=(s.toolbarExclude||"").split(","),u=s.toolbar.split("|");l=e('<div class="sceditor-toolbar" unselectable="on" />');e.each(u,function(s,u){t=e('<div class="sceditor-group" />');e.each(u.split(","),function(s,u){if(!o.commands[u]||e.inArray(u,r)>-1)return;n=i("toolbarButton",{name:u,icon:o._(o.commands[u].icon||"fa-dot-circle-o"),dispName:o._(o.commands[u].tooltip||u)},true);n.data("sceditor-txtmode",!!o.commands[u].txtExec);n.data("sceditor-wysiwygmode",!!o.commands[u].exec);n.click(function(){var t=e(this);if(!t.hasClass("disabled"))j(t,o.commands[u]);ut();return false});if(o.commands[u].tooltip)n.attr("title",o._(o.commands[u].tooltip));if(!o.commands[u].exec)n.addClass("disabled");if(o.commands[u].shortcut)o.addShortcut(o.commands[u].shortcut,u);t.append(n)});if(t[0].firstChild)l.append(t)});e(s.toolbarContainer||f).append(l)};X=function(){e.each(o.commands,function(t,n){if(n.keyPress)y.push(n.keyPress);if(n.forceNewLineAfter&&e.isArray(n.forceNewLineAfter))x=e.merge(x,n.forceNewLineAfter);if(n.state)T.push({name:t,state:n.state});else if(typeof n.exec==="string")T.push({name:t,state:n.exec})});ft()};V=function(){var r,i,u,a,l,c,h=e('<div class="sceditor-grip" />'),p=e('<div class="sceditor-resize-cover" />'),d=0,v=0,m=0,g=0,y=f.width(),b=f.height(),w=false,E=o.rtl();r=s.resizeMinHeight||b/1.5;i=s.resizeMaxHeight||b*2.5;u=s.resizeMinWidth||y/1.25;a=s.resizeMaxWidth||y*1.25;l=function(n){if(n.type==="touchmove")n=t.event;var l=g+(n.pageY-v),c=E?m-(n.pageX-d):m+(n.pageX-d);if(a>0&&c>a)c=a;if(i>0&&l>i)l=i;if(!s.resizeWidth||c<u||a>0&&c>a)c=false;if(!s.resizeHeight||l<r||i>0&&l>i)l=false;if(c||l){o.dimensions(c,l);if(e.sceditor.ie<7)f.height(l)}n.preventDefault()};c=function(t){if(!w)return;w=false;p.hide();f.removeClass("resizing").height("auto");e(n).unbind("touchmove mousemove",l);e(n).unbind("touchend mouseup",c);t.preventDefault()};f.append(h);f.append(p.hide());h.bind("touchstart mousedown",function(r){if(r.type==="touchstart")r=t.event;d=r.pageX;v=r.pageY;m=f.width();g=f.height();w=true;f.addClass("resizing");p.show();e(n).bind("touchmove mousemove",l);e(n).bind("touchend mouseup",c);if(e.sceditor.ie<7)f.height(g);r.preventDefault()})};J=function(){var t,r=s.emoticons,i=s.emoticonsRoot;if(!e.isPlainObject(r)||!s.emoticonsEnabled)return;e.each(r,function(s,o){e.each(o,function(e,o){if(i){o={url:i+(o.url||o),tooltip:o.tooltip||e};r[s][e]=o}t=n.createElement("img");t.src=o.url||o;E.push(t)})})};ht=function(){var t,n,r,i=d[0],u=p[0],a=!!s.autofocusEnd;if(!f.is(":visible"))return;if(o.sourceMode()){r=m.value.length;if(m.setSelectionRange)m.setSelectionRange(r,r);else if(m.createTextRange){t=m.createTextRange();t.moveEnd("character",r);t.moveStart("character",r);S.selectRange(t)}}else{e.sceditor.dom.removeWhiteSpace(u);if(a){if(!(n=u.lastChild))p.append(n=i.createElement("div"));while(n.lastChild){n=n.lastChild;if(/br/i.test(n.nodeName)&&n.previousSibling)n=n.previousSibling}}else n=u.firstChild;if(i.createRange){t=i.createRange();if(/br/i.test(n.nodeName))t.setStartBefore(n);else t.selectNodeContents(n);t.collapse(false)}else{t=u.createTextRange();t.moveToElementText(n.nodeType!==3?n:n.parentNode);t.collapse(false)}S.selectRange(t);if(a){d.scrollTop(u.scrollHeight);p.scrollTop(u.scrollHeight)}}o.focus()};o.readOnly=function(e){if(typeof e!=="boolean")return v.attr("readonly")==="readonly";p[0].contentEditable=!e;if(!e)v.removeAttr("readonly");else v.attr("readonly","readonly");ot(e);return this};o.rtl=function(e){var t=e?"rtl":"ltr";if(typeof e!=="boolean")return v.attr("dir")==="rtl";p.attr("dir",t);v.attr("dir",t);f.removeClass("rtl").removeClass("ltr").addClass(t);return this};ot=function(t){var n=o.inSourceMode();l.find(".sceditor-button").removeClass("disabled").each(function(){var r=e(this);if(t===true||n&&!r.data("sceditor-txtmode"))r.addClass("disabled");else if(!n&&!r.data("sceditor-wysiwygmode"))r.addClass("disabled")})};o.width=function(e,t){if(!e&&e!==0)return f.width();o.dimensions(e,null,t);return this};o.dimensions=function(t,r,i){var u=e.sceditor.ie<8||n.documentMode<8?2:0;t=!t&&t!==0?false:t;r=!r&&r!==0?false:r;if(t===false&&r===false)return{width:o.width(),height:o.height()};if(typeof c.data("outerWidthOffset")==="undefined")o.updateStyleCache();if(t!==false){if(i!==false)s.width=t;if(r===false){r=f.height();i=false}f.width(t);t=f.width();c.width(t-c.data("outerWidthOffset"));v.width(t-v.data("outerWidthOffset"));if(e.sceditor.ios&&p)p.width(t-c.data("outerWidthOffset")-(p.outerWidth(true)-p.width()))}if(r!==false){if(i!==false)s.height=r;if(r&&r.toString().indexOf("%")>-1){r=f.height(r).height();f.height("auto")}r-=!s.toolbarContainer?l.outerHeight(true):0;c.height(r-c.data("outerHeightOffset"));v.height(r-u-v.data("outerHeightOffset"))}return this};o.updateStyleCache=function(){c.data("outerWidthOffset",c.outerWidth(true)-c.width());v.data("outerWidthOffset",v.outerWidth(true)-v.width());c.data("outerHeightOffset",c.outerHeight(true)-c.height());v.data("outerHeightOffset",v.outerHeight(true)-v.height())};o.height=function(e,t){if(!e&&e!==0)return f.height();o.dimensions(null,e,t);return this};o.maximize=function(t){if(typeof t==="undefined")return f.is(".sceditor-maximize");t=!!t;if(e.sceditor.ie<7)e("html, body").toggleClass("sceditor-maximize",t);f.toggleClass("sceditor-maximize",t);o.width(t?"100%":s.width,false);o.height(t?"100%":s.height,false);return this};o.expandToContent=function(e){var t=f.height(),n=p[0].scrollHeight||d[0].documentElement.scrollHeight,r=t-c.height(),i=s.resizeMaxHeight||(s.height||a.height())*2;n+=r;if(e!==true&&n>i)n=i;if(n>t)o.height(n)};o.destroy=function(){C.destroy();S=null;b=null;C=null;e(n).unbind("click",it);e(t).unbind("resize orientationChanged",st);e(u.form).unbind("reset",tt).unbind("submit",o.updateOriginal);p.unbind();d.unbind().find("*").remove();v.unbind().remove();l.remove();f.unbind().find("*").unbind().remove();f.remove();a.removeData("sceditor").removeData("sceditorbbcode").show();if(M)a.attr("required","required")};o.createDropDown=function(t,n,r,i){var u,a=g&&g.is(".sceditor-"+n);o.closeDropDown();if(a)return;if(i!==false){e(r).find(":not(input,textarea)").filter(function(){return this.nodeType===1}).attr("unselectable","on")}u={top:t.offset().top,left:t.offset().left,marginTop:t.outerHeight()};e.extend(u,s.dropDownCss);g=e('<div class="sceditor-dropdown sceditor-'+n+'" />').css(u).append(r).appendTo(e("body")).click(function(e){e.stopPropagation()})};it=function(e){if(e.which!==3)o.closeDropDown()};Q=function(e){var t,r,i=p[0],u=d[0],a=0,f=n.createElement("div"),l=u.createDocumentFragment();if(s.disablePasting)return false;if(!s.enablePasteFiltering)return;S.saveRange();n.body.appendChild(f);if(e&&e.clipboardData&&e.clipboardData.getData){if((t=e.clipboardData.getData("text/html"))||(t=e.clipboardData.getData("text/plain"))){f.innerHTML=t;G(i,f);return false}}while(i.firstChild)l.appendChild(i.firstChild);r=function(e,t){if(e.childNodes.length>0){while(e.firstChild)t.appendChild(e.firstChild);while(l.firstChild)e.appendChild(l.firstChild);G(e,t)}else{if(a>25){while(l.firstChild)e.appendChild(l.firstChild);S.restoreRange();return}++a;setTimeout(function(){r(e,t)},20)}};r(i,f);o.focus();return true};G=function(t,n){e.sceditor.dom.fixNesting(n);var r=n.innerHTML;if(C.hasHandler("toSource"))r=C.callOnlyFirst("toSource",r,e(n));n.parentNode.removeChild(n);if(C.hasHandler("toWysiwyg"))r=C.callOnlyFirst("toWysiwyg",r,true);S.restoreRange();o.wysiwygEditorInsertHtml(r,null,true)};o.closeDropDown=function(e){if(g){g.unbind().remove();g=null}if(e===true)o.focus()};K=function(){if(h.contentDocument)return h.contentDocument;if(h.contentWindow&&h.contentWindow.document)return h.contentWindow.document;if(h.document)return h.document;return null};o.wysiwygEditorInsertHtml=function(t,n,r){var i,s,u='<span id="sceditor-cursor">&nbsp;</span>';o.focus();if(!r&&(e(L).is("code")||e(L).parents("code").length!==0))return;if(n)n+=u;else t+=u;S.insertHTML(t,n);s=p.find("#sceditor-cursor");i=s.offset().top+s.outerHeight(true)*2-c.height();s.remove();d.scrollTop(i);p.scrollTop(i);S.saveRange();B(p[0]);S.restoreRange();ft()};o.wysiwygEditorInsertText=function(t,n){o.wysiwygEditorInsertHtml(e.sceditor.escapeEntities(t),e.sceditor.escapeEntities(n))};o.insertText=function(e,t){if(o.inSourceMode())o.sourceEditorInsertText(e,t);else o.wysiwygEditorInsertText(e,t);return this};o.sourceEditorInsertText=function(e,t){var r,i,s,o,u;u=m.scrollTop;m.focus();if(typeof m.selectionStart!=="undefined"){i=m.selectionStart;s=m.selectionEnd;o=e.length;if(t)e+=m.value.substring(i,s)+t;m.value=m.value.substring(0,i)+e+m.value.substring(s,m.value.length);m.selectionStart=i+e.length-(t?t.length:0);m.selectionEnd=m.selectionStart}else if(typeof n.selection.createRange!=="undefined"){r=n.selection.createRange();if(t)e+=r.text+t;r.text=e;if(t)r.moveEnd("character",0-t.length);r.moveStart("character",r.End-r.Start);r.select()}else m.value+=e+t;m.scrollTop=u;m.focus()};o.getRangeHelper=function(){return S};o.val=function(e,t){if(typeof e==="string"){if(o.inSourceMode())o.setSourceEditorValue(e);else{if(t!==false&&C.hasHandler("toWysiwyg"))e=C.callOnlyFirst("toWysiwyg",e);o.setWysiwygEditorValue(e)}return this}return o.inSourceMode()?o.getSourceEditorValue(false):o.getWysiwygEditorValue()};o.insert=function(t,n,r,i,s){if(o.inSourceMode())o.sourceEditorInsertText(t,n);else{if(n){var u=o.getRangeHelper().selectedHtml(),a=e("<div>").appendTo(e("body")).hide().html(u);if(r!==false&&C.hasHandler("toSource"))u=C.callOnlyFirst("toSource",u,a);a.remove();t+=u+n}if(r!==false&&C.hasHandler("toWysiwyg"))t=C.callOnlyFirst("toWysiwyg",t,true);if(r!==false&&s===true){t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&/g,"&")}o.wysiwygEditorInsertHtml(t)}return this};o.getWysiwygEditorValue=function(t){var n,r,i=S.hasSelection();if(i)S.saveRange();else if(b&&b.getBookmark)r=b.getBookmark();e.sceditor.dom.fixNesting(p[0]);n=p.html();if(t!==false&&C.hasHandler("toSource"))n=C.callOnlyFirst("toSource",n,p);if(i){S.restoreRange();b=null}else if(r){b.moveToBookmark(r);b=null}return n};o.getBody=function(){return p};o.getContentAreaContainer=function(){return c};o.getSourceEditorValue=function(e){var t=v.val();if(e!==false&&C.hasHandler("toWysiwyg"))t=C.callOnlyFirst("toWysiwyg",t);return t};o.setWysiwygEditorValue=function(t){if(!t)t="<p>"+(e.sceditor.ie?"":"<br />")+"</p>";p[0].innerHTML=t;B(p[0]);ft()};o.setSourceEditorValue=function(e){v.val(e)};o.updateOriginal=function(){a.val(o.val())};B=function(t){if(!s.emoticonsEnabled||e(t).parents("code").length)return;var n=t.ownerDocument,r=[],o=[],u=e.extend({},s.emoticons.more,s.emoticons.dropdown,s.emoticons.hidden);e.each(u,function(t){if(s.emoticonsCompat)o[t]=new RegExp("(>|^|\\s| | | | |&nbsp;)"+e.sceditor.regexEscape(t)+"(\\s|$|<| | | | |&nbsp;)");r.push(t)});(function a(t){t=t.firstChild;while(t!=null){var f,l,c,h,p,d,v,m=t.parentNode,g=t.nodeValue;if(t.nodeType!==3){if(!e(t).is("code"))a(t)}else if(g){p=r.length;while(p--){l=r[p];v=s.emoticonsCompat?g.search(o[l]):g.indexOf(l);if(v>-1){d=t.nextSibling;c=u[l];f=g.substr(v).split(l);g=g.substr(0,v)+f.shift();t.nodeValue=g;h=e.sceditor.dom.parseHTML(i("emoticon",{key:l,url:c.url||c,tooltip:c.tooltip||l}),n);m.insertBefore(h[0],d);m.insertBefore(n.createTextNode(f.join(l)),d)}}}t=t.nextSibling}})(t);if(s.emoticonsCompat)P=p.find("img[data-sceditor-emoticon]")};o.inSourceMode=function(){return f.hasClass("sourceMode")};o.sourceMode=function(e){if(typeof e!=="boolean")return o.inSourceMode();if(o.inSourceMode()&&!e||!o.inSourceMode()&&e)o.toggleSourceMode();return this};o.toggleSourceMode=function(){if(!e.sceditor.isWysiwygSupported&&o.inSourceMode())return;o.blur();if(o.inSourceMode())o.setWysiwygEditorValue(o.getSourceEditorValue());else o.setSourceEditorValue(o.getWysiwygEditorValue());b=null;v.toggle();c.toggle();if(!o.inSourceMode())f.removeClass("wysiwygMode").addClass("sourceMode");else f.removeClass("sourceMode").addClass("wysiwygMode");ot();ut()};at=function(){m.focus();if(m.selectionStart!=null)return m.value.substring(m.selectionStart,m.selectionEnd);else if(n.selection.createRange)return n.selection.createRange().text};j=function(t,n){if(o.inSourceMode()){if(n.txtExec){if(e.isArray(n.txtExec))o.sourceEditorInsertText.apply(o,n.txtExec);else n.txtExec.call(o,t,at())}return}if(!n.exec)return;if(e.isFunction(n.exec))n.exec.call(o,t);else o.execCommand(n.exec,n.hasOwnProperty("execParam")?n.execParam:null)};F=function(){if(e.sceditor.ie)b=S.selectedRange()};o.execCommand=function(t,n){var r=false,i=e(S.parentNode());o.focus();if(i.is("code")||i.parents("code").length!==0)return;try{r=d[0].execCommand(t,false,n)}catch(s){}if(!r&&o.commands[t]&&o.commands[t].errorMessage)alert(o._(o.commands[t].errorMessage))};lt=function(){var t=function(){if(S&&!S.compare(A)){A=S.cloneSelected();f.trigger(e.Event("selectionchanged"))}O=false};if(O)return;O=true;if(e.sceditor.ie)t();else setTimeout(t,100)};ct=function(){var t,n=S.parentNode();if(k!==n){t=k;k=n;L=S.getFirstBlockParent(n);f.trigger(e.Event("nodechanged",{oldNode:t,newNode:k}))}};o.currentNode=function(){return k};o.currentBlockNode=function(){return L};ut=function(e){var t,n,r,i,s,u=d[0],a=T.length,f=o.sourceMode();if(!o.sourceMode()&&!o.readOnly()){s=e?e.newNode:S.parentNode();r=S.getFirstBlockParent(s);while(a--){t=0;n=T[a];i=l.find(".sceditor-button-"+n.name);if(f&&!i.data("sceditor-txtmode"))i.addClass("disabled");else if(!f&&!i.data("sceditor-wysiwygmode"))i.addClass("disabled");else{if(typeof n.state==="string"){try{t=u.queryCommandEnabled(n.state)?0:-1;if(t>-1)t=u.queryCommandState(n.state)?1:0}catch(c){}}else t=n.state.call(o,s,r);if(t<0)i.addClass("disabled");else i.removeClass("disabled");if(t>0)i.addClass("active");else i.removeClass("active")}}}else l.find(".sceditor-button").removeClass("active")};et=function(t){var n,r=y.length;o.closeDropDown();n=e(k);if(t.which===13){if(n.is("code,blockquote,pre")||n.parents("code,blockquote,pre").length!==0){b=null;o.wysiwygEditorInsertHtml("<br />",null,true);return false}}if(n.is("code")||n.parents("code").length!==0)return;while(r--)y[r].call(o,t,h,v)};ft=function(){var t,n,r;e.sceditor.dom.rTraverse(p[0],function(i){t=i.nodeName.toLowerCase();if(e.inArray(t,x)>-1)n=true;if(i.nodeType===3&&!/^\s*$/.test(i.nodeValue)||t==="br"||e.sceditor.ie&&!i.firstChild&&!e.sceditor.dom.isInline(i,false)){if(n){r=p[0].ownerDocument.createElement("div");r.className="sceditor-nlf";r.innerHTML=!e.sceditor.ie?"<br />":"";p[0].appendChild(r)}return false}})};tt=function(){o.val(a.val())};nt=function(){o.closeDropDown();b=null};st=function(){var e=s.height,t=s.width;if(!o.maximize()){if(e&&e.toString().indexOf("%")>-1)o.height(e);if(t&&t.toString().indexOf("%")>-1)o.width(t)}else o.dimensions("100%","100%",false)};o._=function(){var e=arguments;if(w&&w[e[0]])e[0]=w[e[0]];return e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n-0+1]!=="undefined"?e[n-0+1]:"{"+n+"}"})};rt=function(t){var n,r=e.extend({},t);C.call(r.type+"Event",t,o);delete r.type;n=e.Event((t.target===m?"scesrc":"scewys")+t.type,r);f.trigger.apply(f,[n,o]);if(n.isDefaultPrevented())t.preventDefault();if(n.isImmediatePropagationStopped())n.stopImmediatePropagation();if(n.isPropagationStopped())n.stopPropagation()};o.bind=function(t,n,r,i){var s=t.length;t=t.split(" ");while(s--){if(e.isFunction(n)){if(!r)f.bind("scewys"+t[s],n);if(!i)f.bind("scesrc"+t[s],n)}}return this};o.unbind=function(t,n,r,i){var s=t.length;t=t.split(" ");while(s--){if(e.isFunction(n)){if(!r)f.unbind("scewys"+t[s],n);if(!i)f.unbind("scesrc"+t[s],n)}}return this};o.blur=function(t,n,r){if(e.isFunction(t))o.bind("blur",t,n,r);else if(!o.sourceMode()){if(!N)N=e('<input style="position:absolute;width:0;height:0;opacity:0;border:0;padding:0;filter:alpha(opacity=0)" type="text" />').appendTo(f);N.removeAttr("disabled").show().focus().blur().hide().attr("disabled","disabled")}else v.blur();return this};o.focus=function(t,n,r){if(e.isFunction(t))o.bind("focus",t,n,r);else{if(!o.inSourceMode()){h.contentWindow.focus();p[0].focus();if(b){S.selectRange(b);b=null}}else m.focus()}return this};o.keyDown=function(e,t,n){return o.bind("keydown",e,t,n)};o.keyPress=function(e,t,n){return o.bind("keypress",e,t,n)};o.keyUp=function(e,t,n){return o.bind("keyup",e,t,n)};o.nodeChanged=function(e){return o.bind("nodechanged",e,false,true)};o.selectionChanged=function(e){return o.bind("selectionchanged",e,false,true)};pt=function(t){var n=0,r=String.fromCharCode(t.which);if(e(L).is("code")||e(L).parents("code").length)return;if(!o.emoticonsCache){o.emoticonsCache=[];e.each(e.extend({},s.emoticons.more,s.emoticons.dropdown,s.emoticons.hidden),function(e,t){o.emoticonsCache[n++]=[e,i("emoticon",{key:e,url:t.url||t,tooltip:t.tooltip||e})]});o.emoticonsCache.sort(function(e,t){return e[0].length-t[0].length});o.longestEmoticonCode=o.emoticonsCache[o.emoticonsCache.length-1][0].length}if(o.getRangeHelper().raplaceKeyword(o.emoticonsCache,true,true,o.longestEmoticonCode,s.emoticonsCompat,r)){if(s.emoticonsCompat)P=p.find("img[data-sceditor-emoticon]");return/^\s$/.test(r)&&s.emoticonsCompat}};dt=function(){if(!P.length)return;var t,n,r,i,s,u,a=o.currentBlockNode(),f=false,l=/[^\s\xA0\u2002\u2003\u2009]+/;P=e.map(P,function(o){if(!o||!o.parentNode)return null;if(!e.contains(a,o))return o;t=o.previousSibling;n=o.nextSibling;s=t.nodeValue;if(s===null)s=t.innerText||"";if((!t||!l.test(t.nodeValue.slice(-1)))&&(!n||!l.test((n.nodeValue||"")[0])))return o;r=o.parentNode;i=S.cloneSelected();u=i.startContainer;s=s+e(o).data("sceditor-emoticon");if(u===n)f=s.length+i.startOffset;else if(u===a&&a.childNodes[i.startOffset]===n)f=s.length;else if(u===t)f=i.startOffset;if(!n||n.nodeType!==3)n=r.insertBefore(r.ownerDocument.createTextNode(""),n);n.insertData(0,s);r.removeChild(t);r.removeChild(o);if(f!==false){i.setStart(n,f);i.collapse(true);S.selectRange(i)}return null})};o.emoticons=function(t){if(!t&&t!==false)return s.emoticonsEnabled;s.emoticonsEnabled=t;if(t){p.keypress(pt);if(!o.sourceMode()){S.saveRange();B(p[0]);P=p.find("img[data-sceditor-emoticon]");S.restoreRange()}}else{p.find("img[data-sceditor-emoticon]").replaceWith(function(){return e(this).data("sceditor-emoticon")});P=[];p.unbind("keypress",pt)}return this};o.css=function(t){if(!_)_=e('<style id="#inline" />').appendTo(d.find("head"))[0];if(typeof t!="string")return _.styleSheet?_.styleSheet.cssText:_.innerHTML;if(_.styleSheet)_.styleSheet.cssText=t;else _.innerHTML=t;return this};Y=function(e){var t=[],n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},r={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},s=e.which,u=r[s]||String.fromCharCode(s).toLowerCase();if(e.ctrlKey)t.push("ctrl");if(e.altKey)t.push("alt");if(e.shiftKey){t.push("shift");if(i[s])u=i[s];else if(n[u])u=n[u]}if(u&&(s<16||s>18))t.push(u);t=t.join("+");if(D[t])return D[t].call(o)};o.addShortcut=function(e,t){e=e.toLowerCase();if(typeof t==="string"){D[e]=function(){j(l.find(".sceditor-button-"+t),o.commands[t]);return false}}else D[e]=t;return this};o.removeShortcut=function(e){delete D[e.toLowerCase()];return this};Z=function(n){var r,i,u,a,f;if(e.sceditor.ie||s.disableBlockRemove||n.which!==8||!(a=S.selectedRange()))return;if(!t.getSelection){r=a.parentElement();u=d[0].selection.createRange();u.moveToElementText(r);u.setEndPoint("EndToStart",a);i=u.text.length}else{r=a.startContainer;i=a.startOffset}if(i!==0||!(f=vt()))return;while(r!==f){while(r.previousSibling){r=r.previousSibling;if(r.nodeType!==3||r.nodeValue)return}if(!(r=r.parentNode))return}if(!f||e(f).is("body"))return;o.clearBlockFormatting(f);return false};vt=function(){var t=L;while(!e.sceditor.dom.hasStyling(t)){if(!(t=t.parentNode)||e(t).is("body"))return}return t};o.clearBlockFormatting=function(t){t=t||vt();if(!t||e(t).is("body"))return this;S.saveRange();b=null;t.className="";e(t).attr("style","");if(!e(t).is("p,div"))e.sceditor.dom.convertElement(t,"p");S.restoreRange();return this};H()};e.sceditor.ie=function(){var e,r=3,i=n.createElement("div"),s=i.getElementsByTagName("i");do{i.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->"}while(s[0]);if(n.documentMode&&n.all&&t.atob)r=10;if(r===4&&n.documentMode)r=11;return r>4?r:e}();e.sceditor.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent);e.sceditor.isWysiwygSupported=function(){var t,n,r=e('<div contenteditable="true">')[0].contentEditable,i=typeof r!=="undefined"&&r!=="inherit",s=navigator.userAgent;if(!i)return false;n=/Opera Mobi|Opera Mini/i.test(s);if(/Android/i.test(s)){n=true;if(/Safari/.test(s)){t=/Safari\/(\d+)/.exec(s);n=!t||!t[1]?true:t[1]<534}}if(/ Silk\//i.test(s)){t=/AppleWebKit\/(\d+)/.exec(s);n=!t||!t[1]?true:t[1]<534}if(e.sceditor.ios)n=!/OS [5-9](_\d)+ like Mac OS X/i.test(s);if(/fennec/i.test(s))n=false;if(/OneBrowser/i.test(s))n=false;if(navigator.vendor==="UCWEB")n=false;return!n}();e.sceditor.regexEscape=function(e){return e.replace(/[\$\?\[\]\.\*\(\)\|\\]/g,"\\$&")};e.sceditor.escapeEntities=function(e){if(!e)return e;return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ {2}/g," &nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />")};e.sceditor.locale={};e.sceditor.commands={bold:{exec:"bold",tooltip:"Negrita",icon:"fa-bold",shortcut:"ctrl+b"},italic:{exec:"italic",tooltip:"Italic",icon:"fa-italic",shortcut:"ctrl+i"},underline:{exec:"underline",tooltip:"Subrayar",icon:"fa-underline",shortcut:"ctrl+u"},strike:{exec:"strikethrough",tooltip:"Tachar",icon:"fa-strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript",icon:"fa-subscript"},superscript:{exec:"superscript",tooltip:"Superscript",icon:"fa-superscript"},left:{exec:"justifyleft",tooltip:"Align left",icon:"fa-align-left"},center:{exec:"justifycenter",tooltip:"Centrar",icon:"fa-align-center"},right:{exec:"justifyright",tooltip:"Align right",icon:"fa-align-right"},justify:{exec:"justifyfull",tooltip:"Justificar",icon:"fa-align-justify"},font:{_dropDown:function(t,n,r){var s=t.opts.fonts.split(","),o=e("<div />"),u=function(){r(e(this).data("font"));t.closeDropDown(true);return false};for(var a=0;a<s.length;a++)o.append(i("fontOpt",{font:s[a]},true).click(u));t.createDropDown(n,"font-picker",o)},exec:function(t){var n=this;e.sceditor.command.get("font")._dropDown(n,t,function(e){n.execCommand("fontname",e)})},tooltip:"Tipo de fuente",icon:"fa-font"},size:{_dropDown:function(t,n,r){var s=e("<div />"),o=function(n){r(e(this).data("size"));t.closeDropDown(true);n.preventDefault()};for(var u=1;u<=7;u++)s.append(i("sizeOpt",{size:u},true).click(o));t.createDropDown(n,"fontsize-picker",s)},exec:function(t){var n=this;e.sceditor.command.get("size")._dropDown(n,t,function(e){n.execCommand("fontsize",e)})},tooltip:"Tamaño de fuente",icon:"fa-text-height"},color:{_dropDown:function(t,n,r){var i,s,o,u,a={r:255,g:255,b:255},f=e("<div />"),l=t.opts.colors?t.opts.colors.split("|"):new Array(21),c=[],h=e.sceditor.command.get("color");if(!h._htmlCache){for(i=0;i<l.length;++i){u=l[i]?l[i].split(","):new Array(21);c.push('<div class="sceditor-color-column">');for(s=0;s<u.length;++s){o=u[s]||"#"+a.r.toString(16)+a.g.toString(16)+a.b.toString(16);c.push('<a href="#" class="sceditor-color-option" style="background-color: '+o+'" data-color="'+o+'"></a>');if(s%5===0){a.g-=51;a.b=255}else a.b-=51}c.push("</div>");if(i%5===0){a.r-=51;a.g=255;a.b=255}else{a.g=255;a.b=255}}h._htmlCache=c.join("")}f.append(h._htmlCache).find("a").click(function(n){r(e(this).attr("data-color"));t.closeDropDown(true);n.preventDefault()});t.createDropDown(n,"color-picker",f)},exec:function(t){var n=this;e.sceditor.command.get("color")._dropDown(n,t,function(e){n.execCommand("forecolor",e)})},tooltip:"Color de fuente",icon:"fa-pencil-square-o"},removeformat:{exec:"removeformat",tooltip:"Quitar estilo",icon:"fa-eraser"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(e){var t,n=this,r=i("pastetext",{label:n._("Paste your text inside the following box:"),insert:n._("Insert")},true);r.find(".button").click(function(e){t=r.find("#txt").val();if(t)n.wysiwygEditorInsertText(t);n.closeDropDown(true);e.preventDefault()});n.createDropDown(e,"pastetext",r)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Lista simple",icon:"fa-list-ul"},orderedlist:{exec:"insertorderedlist",tooltip:"Lista ordenada",icon:"fa-list-ol"},table:{exec:function(t){var n=this,r=i("table",{rows:n._("Rows:"),cols:n._("Cols:"),insert:n._("Insert")},true);r.find(".button").click(function(t){var i=r.find("#rows").val()-0,s=r.find("#cols").val()-0,o="<table>";if(i<1||s<1)return;for(var u=0;u<i;u++){o+="<tr>";for(var a=0;a<s;a++)o+="<td>"+(e.sceditor.ie?"":"<br />")+"</td>";o+="</tr>"}o+="</table>";n.wysiwygEditorInsertHtml(o);n.closeDropDown(true);t.preventDefault()});n.createDropDown(t,"inserttable",r)},tooltip:"Tabla",icon:"fa-table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Linea horizontal",icon:"fa-arrows-h"},code:{forceNewLineAfter:["code"],exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(e){var t=this,n=i("image",{url:t._("URL:"),width:t._("Width (optional):"),height:t._("Height (optional):"),insert:t._("Insert")},true);n.find(".button").click(function(e){var r=n.find("#image").val(),i=n.find("#width").val(),s=n.find("#height").val(),o="";if(i)o+=' width="'+i+'"';if(s)o+=' height="'+s+'"';if(r&&r!=="http://")t.wysiwygEditorInsertHtml("<img"+o+' src="'+r+'" />');t.closeDropDown(true);e.preventDefault()});t.createDropDown(e,"insertimage",n)},tooltip:"Imagen",icon:"fa-picture-o"},email:{exec:function(e){var t=this,n=i("email",{label:t._("E-mail:"),insert:t._("Insert")},true);n.find(".button").click(function(e){var r=n.find("#email").val();if(r){t.focus();if(!t.getRangeHelper().selectedHtml())t.wysiwygEditorInsertHtml('<a href="'+"mailto:"+r+'">'+r+"</a>");else t.execCommand("createlink","mailto:"+r)}t.closeDropDown(true);e.preventDefault()});t.createDropDown(e,"insertemail",n)},tooltip:"Insert an email"},link:{exec:function(e){var t=this,n=i("link",{url:t._("URL:"),desc:t._("Description (optional):"),ins:t._("Insert")},true);n.find(".button").click(function(e){var r=n.find("#link").val(),i=n.find("#des").val();if(r&&r!=="http://"){t.focus();if(!t.getRangeHelper().selectedHtml()||i){if(!i)i=r;t.wysiwygEditorInsertHtml('<a href="'+r+'">'+i+"</a>")}else t.execCommand("createlink",r)}t.closeDropDown(true);e.preventDefault()});t.createDropDown(e,"insertlink",n)},tooltip:"Link",icon:"fa-link"},unlink:{state:function(){var t=e(this.currentNode());return t.is("a")||t.parents("a").length>0?0:-1},exec:function(){var t=e(this.currentNode()),n=t.is("a")?t:t.parents("a").first();if(n.length)n.replaceWith(n.contents())},tooltip:"Quitar link",icon:"fa-chain-broken"},quote:{forceNewLineAfter:["blockquote"],exec:function(t,n,r){var i="<blockquote>",s="</blockquote>";if(n){r=r?"<cite>"+r+"</cite>":"";i=i+r+n+s;s=null}else if(this.getRangeHelper().selectedHtml()==="")s=e.sceditor.ie?"":"<br />"+s;this.wysiwygEditorInsertHtml(i,s)},tooltip:"Insert a Quote"},emoticon:{exec:function(t){var n=this;var r=function(i){var s=n.opts.emoticonsCompat,o=n.getRangeHelper(),u=s&&o.getOuterText(true,1)!==" "?" ":"",a=s&&o.getOuterText(false,1)!==" "?" ":"",f=e("<div />"),l=e("<div />").appendTo(f),c=e.extend({},n.opts.emoticons.dropdown,i?n.opts.emoticons.more:{}),h=0;e.each(c,function(){h++});h=Math.sqrt(h);e.each(c,function(t,r){l.append(e("<img />").attr({src:r.url||r,alt:t,title:r.tooltip||t}).click(function(){n.insert(u+e(this).attr("alt")+a,null,false).closeDropDown(true);return false}));if(l.children().length>=h)l=e("<div />").appendTo(f)});if(!i){f.append(e(n._('<a class="sceditor-more">{0}</a>',n._("More"))).click(function(){n.createDropDown(t,"more-emoticons",r(true));return false}))}return f};n.createDropDown(t,"emoticons",r(false))},txtExec:function(t){e.sceditor.command.get("emoticon").exec.call(this,t)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(e,t,n){var r,s=i("youtubeMenu",{label:e._("Video URL:"),insert:e._("Insert")},true);s.find(".button").click(function(t){var i=s.find("#link").val().replace("http://","");if(i!==""){r=i.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/);if(r)i=r[1];if(/^[a-zA-Z0-9_\-]{11}$/.test(i))n(i);else alert("Invalid YouTube video")}e.closeDropDown(true);t.preventDefault()});e.createDropDown(t,"insertlink",s)},exec:function(t){var n=this;e.sceditor.command.get("youtube")._dropDown(n,t,function(e){n.wysiwygEditorInsertHtml(i("youtube",{id:e}))})},tooltip:"Video de YouTube",icon:"fa-youtube-play"},date:{_date:function(e){var t=new Date,n=t.getYear(),r=t.getMonth()+1,i=t.getDate();if(n<2e3)n=1900+n;if(r<10)r="0"+r;if(i<10)i="0"+i;return e.opts.dateFormat.replace(/year/i,n).replace(/month/i,r).replace(/day/i,i)},exec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();if(t<10)t="0"+t;if(n<10)n="0"+n;if(r<10)r="0"+r;return t+":"+n+":"+r},exec:function(){this.insertText(e.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(e.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{state:function(e,t){return t&&t.style.direction==="ltr"},exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),r=e(n);t.focus();if(!n||r.is("body")){t.execCommand("formatBlock","p");n=t.getRangeHelper().getFirstBlockParent();r=e(n);if(!n||r.is("body"))return}if(r.css("direction")==="ltr")r.css("direction","");else r.css("direction","ltr")},tooltip:"Left-to-Right"},rtl:{state:function(e,t){return t&&t.style.direction==="rtl"},exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),r=e(n);t.focus();if(!n||r.is("body")){t.execCommand("formatBlock","p");n=t.getRangeHelper().getFirstBlockParent();r=e(n);if(!n||r.is("body"))return}if(r.css("direction")==="rtl")r.css("direction","");else r.css("direction","rtl")},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximizar",icon:"fa-expand",shortcut:"ctrl+shift+m"},source:{exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"Modo código",icon:"fa-code",shortcut:"ctrl+shift+s"},ignore:{}};e.sceditor.rangeHelper=function(t,n){var r,i,s,o,u,a=true,f="sceditor-start-marker",l="sceditor-end-marker",c="character",h=this;s=function(e,t){i=t||e.contentDocument||e.document;r=e;a=!!e.getSelection}(t,n);h.insertHTML=function(e,t){var n,r,s=h.selectedRange();if(t)e+=h.selectedHtml()+t;if(a){r=i.createElement("div");n=i.createDocumentFragment();r.innerHTML=e;while(r.firstChild)n.appendChild(r.firstChild);h.insertNode(n)}else{if(!s)return false;s.pasteHTML(e)}};h.insertNode=function(e,t){if(a){var n,r,s=i.createDocumentFragment(),o=h.selectedRange();if(!o)return false;s.appendChild(e);if(t){s.appendChild(o.extractContents());s.appendChild(t)}r=s.lastChild;if(!r)return;o.deleteContents();o.insertNode(s);n=i.createRange();n.setStartAfter(r);h.selectRange(n)}else h.insertHTML(e.outerHTML,t?t.outerHTML:null)};h.cloneSelected=function(){var e=h.selectedRange();if(e)return a?e.cloneRange():e.duplicate()};h.selectedRange=function(){var e,t,n=a?r.getSelection():i.selection;if(!n)return;if(n.getRangeAt&&n.rangeCount<=0){t=i.body;while(t.firstChild)t=t.firstChild;e=i.createRange();e.setStart(t,0);n.addRange(e)}if(a)e=n.getRangeAt(0);if(!a&&n.type!=="Control")e=n.createRange();return u(e)?e:null};u=function(e){var t;return e&&e.parentElement&&(t=e.parentElement())?t.ownerDocument===i:true};h.hasSelection=function(){var e,t=a?r.getSelection():i.selection;if(a||!t)return t&&t.rangeCount>0;e=t.createRange();return e&&u(e)};h.selectedHtml=function(){var e,t=h.selectedRange();if(!t)return"";if(!a&&t.text!==""&&t.htmlText)return t.htmlText;if(a){e=i.createElement("div");e.appendChild(t.cloneContents());return e.innerHTML}return""};h.parentNode=function(){var e=h.selectedRange();if(e)return e.parentElement?e.parentElement():e.commonAncestorContainer};h.getFirstBlockParent=function(t){var n=function(t){if(!e.sceditor.dom.isInline(t,true))return t;t=t?t.parentNode:null;return t?n(t):null};return n(t||h.parentNode())};h.insertNodeAt=function(e,t){var n=h.selectedRange(),r=h.cloneSelected();if(!r)return false;r.collapse(e);if(r.insertNode)r.insertNode(t);else r.pasteHTML(t.outerHTML);h.selectRange(n)};o=function(e){h.removeMarker(e);var t=i.createElement("span");t.id=e;t.style.lineHeight="0";t.style.display="none";t.className="sceditor-selection sceditor-ignore";t.innerHTML=" ";return t};h.insertMarkers=function(){h.insertNodeAt(true,o(f));h.insertNodeAt(false,o(l))};h.getMarker=function(e){return i.getElementById(e)};h.removeMarker=function(e){var t=h.getMarker(e);if(t)t.parentNode.removeChild(t)};h.removeMarkers=function(){h.removeMarker(f);h.removeMarker(l)};h.saveRange=function(){h.insertMarkers()};h.selectRange=function(e){if(a){r.getSelection().removeAllRanges();r.getSelection().addRange(e)}else e.select()};h.restoreRange=function(){var e,t=h.selectedRange(),n=h.getMarker(f),r=h.getMarker(l);if(!n||!r||!t)return false;if(!a){t=i.body.createTextRange();e=i.body.createTextRange();e.moveToElementText(n);t.setEndPoint("StartToStart",e);t.moveStart(c,0);e.moveToElementText(r);t.setEndPoint("EndToStart",e);t.moveEnd(c,0);h.selectRange(t)}else{t=i.createRange();t.setStartBefore(n);t.setEndAfter(r);h.selectRange(t)}h.removeMarkers()};h.selectOuterText=function(e,t){var n=h.cloneSelected();if(!n)return false;n.collapse(false);if(!a){n.moveStart(c,0-e);n.moveEnd(c,t)}else{n.setStart(n.startContainer,n.startOffset-e);n.setEnd(n.endContainer,n.endOffset+t)}h.selectRange(n)};h.getOuterText=function(e,t){var n="",r=h.cloneSelected();if(!r)return"";r.collapse(false);if(e){if(!a){r.moveStart(c,0-t);n=r.text}else{n=r.startContainer.textContent.substr(0,r.startOffset);n=n.substr(Math.max(0,n.length-t))}}else{if(!a){r.moveEnd(c,t);n=r.text}else n=r.startContainer.textContent.substr(r.startOffset,t)}return n};h.raplaceKeyword=function(t,n,r,i,s,o){if(!r){t.sort(function(e,t){return e.length-t.length})}var u,f,l,c,p,d,v,m=t.length,g=i||t[m-1][0].length;if(s){if(!a)return false;++g}u=h.getOuterText(true,g);f=u+(o!=null?o:"");if(n)f+=h.getOuterText(false,g);while(m--){v=t[m][0];p=new RegExp("(?:[\\s    ])"+e.sceditor.regexEscape(v)+"(?=[\\s    ])");d=u.length-1-v.length;if(s)--d;d=Math.max(0,d);if((l=s?f.substr(d).search(p):f.indexOf(v,d))>-1){if(s)l+=d+1;if(l>u.length||l+v.length+(s?1:0)<u.length)continue;c=u.length-l;h.selectOuterText(c,v.length-c-(o!=null&&/^\S/.test(o)?1:0));h.insertHTML(t[m][1]);return true}}return false};h.compare=function(e,t){if(!t)t=h.selectedRange();if(!e||!t)return!e&&!t;if(!a){return u(e)&&u(t)&&e.compareEndPoints("EndToEnd",t)===0&&e.compareEndPoints("StartToStart",t)===0}return e.compareBoundaryPoints(Range.END_TO_END,t)===0&&e.compareBoundaryPoints(Range.START_TO_START,t)===0}};e.sceditor.dom={traverse:function(e,t,n,r,i){if(e){e=i?e.lastChild:e.firstChild;while(e!=null){var s=i?e.previousSibling:e.nextSibling;if(!n&&t(e)===false)return false;if(!r&&this.traverse(e,t,n,r,i)===false)return false;if(n&&t(e)===false)return false;e=s}}},rTraverse:function(e,t,n,r){this.traverse(e,t,n,r,true)},parseHTML:function(t,r){var i=[],s=(r||n).createElement("div");s.innerHTML=t;e.merge(i,s.childNodes);return i},hasStyling:function(t){var n=e(t);return t&&(!n.is("p,div")||t.className||n.attr("style")||!e.isEmptyObject(n.data()))},convertElement:function(t,n){var r,i,s=t.attributes.length,o=t.ownerDocument.createElement(n);while(s--){i=t.attributes[s];if(!e.sceditor.ie||i.specified){if(e.sceditor.ie<8&&/style/i.test(i.name))t.style.cssText=t.style.cssText;else o.setAttribute(i.name,i.value)}}while(r=t.firstChild)o.appendChild(r);t.parentNode.replaceChild(o,t);return o},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",isInline:function(t,n){if(!t||t.nodeType!==1)return true;t=t.tagName.toLowerCase();if(t==="code")return!n;return e.sceditor.dom.blockLevelList.indexOf("|"+t+"|")<0},copyCSS:function(e,t){t.style.cssText=e.style.cssText+t.style.cssText},fixNesting:function(e){var t=this,n=function(e){while(t.isInline(e.parentNode,true))e=e.parentNode;return e};t.traverse(e,function(e){if(e.nodeType===1&&!t.isInline(e,true)&&t.isInline(e.parentNode,true)){var r=n(e),i=r.parentNode,s=t.extractContents(r,e),o=e;t.copyCSS(r,o);i.insertBefore(s,r);i.insertBefore(o,r)}})},findCommonAncestor:function(t,n){return e(t).parents().has(e(n)).first()},getSibling:function(t,n){var r;if(!t)return null;if(r=t[n?"previousSibling":"nextSibling"])return r;return e.sceditor.dom.getSibling(t.parentNode,n)},removeWhiteSpace:function(t,n){var r,i,s,o,u,a,f,l,c=e.sceditor.dom.getSibling,h=e.sceditor.dom.isInline,p=t.firstChild,d=/[\t ]+/g,v=/[\t\n\r ]+/g;while(p){a=p.nextSibling;r=p.nodeValue;i=p.nodeType;if(i===1&&p.firstChild){u=e(p).css("whiteSpace");if(!/pre(?:\-wrap)?$/i.test(u))e.sceditor.dom.removeWhiteSpace(p,/line$/i.test(u))}if(i===3&&r){s=c(p);o=c(p,true);l=o;f=false;while(e(l).hasClass("sceditor-ignore"))l=c(l,true);if(h(p)&&l){while(l.lastChild)l=l.lastChild;f=l.nodeType===3?/[\t\n\r ]$/.test(l.nodeValue):!h(l)}if(!h(p)||!o||!h(o)||f)r=r.replace(/^[\t\n\r ]+/,"");if(!h(p)||!s||!h(s))r=r.replace(/[\t\n\r ]+$/,"");if(!r.length)t.removeChild(p);else p.nodeValue=r.replace(n?d:v," ")}p=a}},extractContents:function(e,t){var n=this,r=n.findCommonAncestor(e,t),i=!r?null:r[0],s=false,o=false;return function u(r){var i=e.ownerDocument.createDocumentFragment();n.traverse(r,function(n){if(o||n===t&&s){o=true;return false}if(n===e)s=true;var r,a;if(s){if(jQuery.contains(n,t)&&n.nodeType===1){r=u(n);a=n.cloneNode(false);a.appendChild(r);i.appendChild(a)}else i.appendChild(n)}else if(jQuery.contains(n,e)&&n.nodeType===1){r=u(n);a=n.cloneNode(false);a.appendChild(r);i.appendChild(a)}},false);return i}(i)}};e.sceditor.plugins={};e.sceditor.PluginManager=function(t){var n=this;var r=[];var i=t;var s=function(e){return"signal"+e.charAt(0).toUpperCase()+e.slice(1)};var o=function(e,t){e=[].slice.call(e);var n=r.length,o=s(e.shift());while(n--){if(o in r[n]){if(t)return r[n][o].apply(i,e);r[n][o].apply(i,e)}}};n.call=function(){o(arguments,false)};n.callOnlyFirst=function(){return o(arguments,true)};n.iter=function(e){e=s(e);return function(){var t=r.length;return{callNext:function(n){while(t--)if(r[t]&&e in r[t])return r[t].apply(i,n)},hasNext:function(){var n=t;while(n--)if(r[n]&&e in r[n])return true;return false}}}()};n.hasHandler=function(e){var t=r.length;e=s(e);while(t--)if(e in r[t])return true;return false};n.exsists=function(t){if(t in e.sceditor.plugins){t=e.sceditor.plugins[t];return typeof t==="function"&&typeof t.prototype==="object"}return false};n.isRegistered=function(t){var i=r.length;if(!n.exsists(t))return false;while(i--)if(r[i]instanceof e.sceditor.plugins[t])return true;return false};n.register=function(t){if(!n.exsists(t))return false;t=new e.sceditor.plugins[t];r.push(t);if("init"in t)t.init.apply(i);return true};n.deregister=function(t){var s,o=r.length,u=false;if(!n.isRegistered(t))return false;while(o--){if(r[o]instanceof e.sceditor.plugins[t]){s=r.splice(o,1)[0];u=true;if("destroy"in s)s.destroy.apply(i)}}return u};n.destroy=function(){var e=r.length;while(e--)if("destroy"in r[e])r[e].destroy.apply(i);r=null;i=null}};e.sceditor.command={get:function(t){return e.sceditor.commands[t]||null},set:function(t,n){if(!t||!n)return false;n=e.extend(e.sceditor.commands[t]||{},n);n.remove=function(){e.sceditor.command.remove(t)};e.sceditor.commands[t]=n;return this},remove:function(t){if(e.sceditor.commands[t])delete e.sceditor.commands[t];return this}};e.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|"+"font,size,color,removeformat|bulletlist,orderedlist|table,horizontalrule|"+"image,youtube,link,unlink|maximize,source",toolbarExclude:null,style:"",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:"en",charset:"utf-8",emoticonsCompat:false,emoticonsEnabled:false,emoticonsRoot:"",emoticons:{dropdown:{},more:{},hidden:{}},width:null,height:null,resizeEnabled:true,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:true,resizeWidth:false,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:false,disablePasting:false,readOnly:false,rtl:false,autofocus:false,autofocusEnd:true,autoExpand:false,autoUpdate:false,spellcheck:true,runWithoutWysiwygSupport:false,id:null,plugins:"",zIndex:null,bbcodeTrim:false,disableBlockRemove:false,parserOptions:{},dropDownCss:{}};e.fn.sceditor=function(t){var n,r=[];t=t||{};if(!t.runWithoutWysiwygSupport&&!e.sceditor.isWysiwygSupported)return;this.each(function(){n=this.jquery?this:e(this);if(n.parents(".sceditor-container").length>0)return;if(t==="state")r.push(!!n.data("sceditor"));else if(t==="instance")r.push(n.data("sceditor"));else if(!n.data("sceditor"))new e.sceditor(this,t)});if(!r.length)return this;return r.length===1?r[0]:e(r)}})(jQuery,window,document);(function(e,t,n){"use strict";e.sceditor.BBCodeParser=function(t){if(!(this instanceof e.sceditor.BBCodeParser))return new e.sceditor.BBCodeParser(t);var r=this;var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;var b={open:"open",content:"content",newline:"newline",close:"close"};var w=function(e,t,n,r,i,s){var o=this;o.type=e;o.name=t;o.val=n;o.attrs=r||{};o.children=i||[];o.closing=s||null};w.prototype={clone:function(e){var t=this;return new w(t.type,t.name,t.val,t.attrs,e?t.children:[],t.closing?t.closing.clone():null)},splitAt:function(t){var n,r=this,i=0,s=r.children.length;if(typeof object!=="number")t=e.inArray(t,r.children);if(t<0||t>s)return null;while(s--){if(s>=t)i++;else s=0}n=r.clone();n.children=r.children.splice(t,i);return n}};i=function(){r.opts=e.extend({},e.sceditor.BBCodeParser.defaults,t);r.bbcodes=e.sceditor.plugins.bbcode.bbcodes};r.tokenize=function(e){var t,n,r,i=[],o=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];o.reverse();e:while(e.length){r=o.length;while(r--){n=o[r].type;if(!(t=e.match(o[r].regex))||!t[0])continue;i.push(s(n,t[0]));e=e.substr(t[0].length);continue e}if(e.length)i.push(s(b.content,e));e=""}return i};s=function(t,n){var r,i,s;if(t==="open"&&(r=n.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))){s=g(r[1]);if(r[2]&&(r[2]=e.trim(r[2])))i=o(r[2])}else if(t==="close"&&(r=n.match(/\[\/([^\[\]]+)\]/)))s=g(r[1]);else if(t==="newline")s="#newline";if(!s||(t==="open"||t==="close")&&!e.sceditor.plugins.bbcode.bbcodes[s]){t="content";s="#"}return new w(t,s,n,i)};o=function(t){var n,r=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,i=e.sceditor.plugins.bbcode.stripQuotes,s={};if(t.charAt(0)==="="&&t.indexOf("=",1)<0)s.defaultattr=i(t.substr(1));else{if(t.charAt(0)==="=")t="defaultattr"+t;while(n=r.exec(t))s[g(n[1])]=i(n[3])||n[4]}return s};r.parse=function(e,t){var n=u(r.tokenize(e));if(r.opts.fixInvalidChildren)h(n);if(r.opts.removeEmptyTags)c(n);if(r.opts.fixInvalidNesting)f(n);a(n,null,t);if(r.opts.removeEmptyTags)c(n);return n};v=function(e,t,n){var r=n.length;while(r--)if(n[r].type===t&&n[r].name===e)return true;return false};l=function(t,n){var i=t?r.bbcodes[t.name]:null,s=i?i.allowedChildren:null;if(!r.opts.fixInvalidChildren||!s)return true;if(s&&e.inArray(n.name||"#",s)<0)return false;return true};u=function(t){var n,i,s,o,u,a,f,l=[],c=[],h=[],p=function(){return y(h)},d=function(e){if(p())p().children.push(e);else c.push(e)},m=function(t){return p()&&(i=r.bbcodes[p().name])&&i.closedBy&&e.inArray(t,i.closedBy)>-1};while(n=t.shift()){f=t[0];switch(n.type){case b.open:if(m(n.name))h.pop();d(n);i=r.bbcodes[n.name];if((!i||!i.isSelfClosing)&&(i.closedBy||v(n.name,b.close,t)))h.push(n);else if(!i||!i.isSelfClosing)n.type=b.content;break;case b.close:if(p()&&n.name!==p().name&&m("/"+n.name))h.pop();if(p()&&n.name===p().name){p().closing=n;h.pop()}else if(v(n.name,b.open,h)){while(s=h.pop()){if(s.name===n.name){s.closing=n;break}o=s.clone();if(l.length>1)o.children.push(y(l));l.push(o)}d(y(l));u=l.length;while(u--)h.push(l[u]);l.length=0}else{n.type=b.content;d(n)}break;case b.newline:if(p()&&f&&m((f.type===b.close?"/":"")+f.name)){if(!(f.type===b.close&&f.name===p().name)){i=r.bbcodes[p().name];if(i&&i.breakAfter)h.pop();else if(i&&i.isInline===false&&r.opts.breakAfterBlock&&i.breakAfter!==false)h.pop()}}d(n);break;default:d(n);break}a=n}return c};a=function(e,t,n){var i,s,o,u,f,l,c,h,p=e.length,d=p;if(t)u=r.bbcodes[t.name];while(d--){if(!(i=e[d]))continue;if(i.type===b.newline){s=d>0?e[d-1]:null;o=d<p-1?e[d+1]:null;h=false;if(!n&&u&&u.isSelfClosing!==true){if(!s){if(u.isInline===false&&r.opts.breakStartBlock&&u.breakStart!==false)h=true;if(u.breakStart)h=true}else if(!l&&!o){if(u.isInline===false&&r.opts.breakEndBlock&&u.breakEnd!==false)h=true;if(u.breakEnd)h=true;l=h}}if(s&&s.type===b.open){if(f=r.bbcodes[s.name]){if(!n){if(f.isInline===false&&r.opts.breakAfterBlock&&f.breakAfter!==false)h=true;if(f.breakAfter)h=true}else if(f.isInline===false)h=true}}if(!n&&!c&&o&&o.type===b.open){if(f=r.bbcodes[o.name]){if(f.isInline===false&&r.opts.breakBeforeBlock&&f.breakBefore!==false)h=true;if(f.breakBefore)h=true;c=h;if(h){e.splice(d,1);continue}}}if(h)e.splice(d,1);c=false}else if(i.type===b.open)a(i.children,i,n)}};f=function(t,n,i,s){var o,u,a,l,c,h,p=function(e){var t=r.bbcodes[e.name];return!t||t.isInline!==false};n=n||[];s=s||t;for(u=0;u<t.length;u++){if(!(o=t[u])||o.type!==b.open)continue;if(!p(o)&&i){a=y(n);h=a.splitAt(o);c=n.length>1?n[n.length-2].children:s;if((l=e.inArray(a,c))>-1){h.children.splice(e.inArray(o,h.children),1);c.splice(l+1,0,o,h);return}}n.push(o);f(o.children,n,i||p(o),s);n.pop(o)}};h=function(e,t){var n,r,i=e.length;while(i--){if(!(n=e[i]))continue;if(!l(t,n)){n.name=null;n.type=b.content;if(l(t,n)){r=[i+1,0].concat(n.children);if(n.closing){n.closing.name=null;n.closing.type=b.content;r.push(n.closing)}i+=r.length-1;Array.prototype.splice.apply(e,r)}else t.children.splice(i,1)}if(n.type===b.open)h(n.children,n)}};c=function(t){var n,i,s,o=t.length;s=function(e){var t=e.length;while(t--){if(e[t].type===b.open)return false;if(e[t].type===b.close)return false;if(e[t].type===b.content&&e[t].val&&/\S|\u00A0/.test(e[t].val))return false}return true};while(o--){if(!(n=t[o])||n.type!==b.open)continue;i=r.bbcodes[n.name];c(n.children);if(s(n.children)&&i&&!i.isSelfClosing&&!i.allowsEmpty)t.splice.apply(t,e.merge([o,1],n.children))}};r.toHTML=function(e,t){return p(r.parse(e,t),true)};p=function(t,i){var s,o,u,a,f,l,c,h,d=[];c=function(e){return(!e||(typeof e.isHtmlInline!=="undefined"?e.isHtmlInline:e.isInline))!==false};while(t.length>0){if(!(s=t.shift()))continue;if(s.type===b.open){h=s.children[s.children.length-1]||{};o=r.bbcodes[s.name];f=i&&c(o);u=p(s.children,false);if(o&&o.html){if(!c(o)&&c(r.bbcodes[h.name])&&!o.isPreFormatted&&!o.skipLastLineBreak){if(!e.sceditor.ie)u+="<br />"}if(e.isFunction(o.html))a=o.html.call(r,s,s.attrs,u);else a=e.sceditor.plugins.bbcode.formatString(o.html,u)}else a=s.val+u+(s.closing?s.closing.val:"")}else if(s.type===b.newline){if(!i){d.push("<br />");continue}if(!l){d.push("<div>");if(n.documentMode&&n.documentMode<8||e.sceditor.ie<8)d.push(" ")}if(!e.sceditor.ie)d.push("<br />");if(!t.length)d.push("<br />");d.push("</div>\n");l=false;continue}else{f=i;a=e.sceditor.escapeEntities(s.val)}if(f&&!l){d.push("<div>");l=true}else if(!f&&l){d.push("</div>\n");l=false}d.push(a)}if(l)d.push("</div>\n");return d.join("")};r.toBBCode=function(e,t){return d(r.parse(e,t))};d=function(t){var n,i,s,o,u,a,f,l,c,h,p=[];while(t.length>0){if(!(n=t.shift()))continue;s=r.bbcodes[n.name];o=!(!s||s.isInline!==false);u=s&&s.isSelfClosing;f=o&&r.opts.breakBeforeBlock&&s.breakBefore!==false||s&&s.breakBefore;l=o&&!u&&r.opts.breakStartBlock&&s.breakStart!==false||s&&s.breakStart;c=o&&r.opts.breakEndBlock&&s.breakEnd!==false||s&&s.breakEnd;h=o&&r.opts.breakAfterBlock&&s.breakAfter!==false||s&&s.breakAfter;a=(s?s.quoteType:null)||r.opts.quoteType||e.sceditor.BBCodeParser.QuoteType.auto;if(!s&&n.type===b.open){p.push(n.val);if(n.children)p.push(d(n.children));if(n.closing)p.push(n.closing.val)}else if(n.type===b.open){if(f)p.push("\n");p.push("["+n.name);if(n.attrs){if(n.attrs.defaultattr){p.push("="+m(n.attrs.defaultattr,a,"defaultattr"));delete n.attrs.defaultattr}for(i in n.attrs)if(n.attrs.hasOwnProperty(i))p.push(" "+i+"="+m(n.attrs[i],a,i))}p.push("]");if(l)p.push("\n");if(n.children)p.push(d(n.children));if(!u&&!s.excludeClosing){if(c)p.push("\n");p.push("[/"+n.name+"]")}if(h)p.push("\n");if(n.closing&&u)p.push(n.closing.val)}else p.push(n.val)}return p.join("")};m=function(t,n,r){var i=e.sceditor.BBCodeParser.QuoteType,s=/\s|=/.test(t);if(e.isFunction(n))return n(t,r);if(n===i.never||n===i.auto&&!s)return t;return'"'+t.replace("\\","\\\\").replace('"','\\"')+'"'};y=function(e){if(e.length)return e[e.length-1];return null};g=function(e){return e.toLowerCase()};i()};e.sceditor.BBCodeParser.QuoteType={always:1,never:2,auto:3};e.sceditor.BBCodeParser.defaults={breakBeforeBlock:false,breakStartBlock:false,breakEndBlock:false,breakAfterBlock:true,removeEmptyTags:true,fixInvalidNesting:true,fixInvalidChildren:true,quoteType:e.sceditor.BBCodeParser.QuoteType.auto};e.sceditorBBCodePlugin=e.sceditor.plugins.bbcode=function(){var t=this;var r,i,s,o,u,a,f;o=e.sceditor.plugins.bbcode.formatString;t.bbcodes=e.sceditor.plugins.bbcode.bbcodes;t.stripQuotes=e.sceditor.plugins.bbcode.stripQuotes;var l={};var c={};var h={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};var p={};t.init=function(){t.opts=this.opts;r();a(this);this.toBBCode=t.signalToSource;this.fromBBCode=t.signalToWysiwyg};a=function(t){var n=e.sceditor.command.get;var r={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(e){var t=this;n("font")._dropDown(t,e,function(e){t.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(e){var t=this;n("size")._dropDown(t,e,function(e){t.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(e){var t=this;n("color")._dropDown(t,e,function(e){t.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:function(n,r){var i="";e.each(r.split(/\r?\n/),function(){i+=(i?"\n":"")+"[li]"+this+"[/li]"});t.insertText("[ul]\n"+i+"\n[/ul]")}},orderedlist:{txtExec:function(n,r){var i="";e.each(r.split(/\r?\n/),function(){i+=(i?"\n":"")+"[li]"+this+"[/li]"});e.sceditor.plugins.bbcode.bbcode.get("");t.insertText("[ol]\n"+i+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e,t){var n=prompt(this._("Enter the image URL:"),t);if(n)this.insertText("[img]"+n+"[/img]")}},email:{txtExec:function(e,t){var n=t&&t.indexOf("@")>-1?null:t,r=prompt(this._("Enter the e-mail address:"),n?"":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;if(r)this.insertText("[email="+r+"]"+i+"[/email]")}},link:{txtExec:function(e,t){var n=t&&t.indexOf("http://")>-1?null:t,r=prompt(this._("Enter URL:"),n?"http://":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;if(r)this.insertText("[url="+r+"]"+i+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(e){var t=this;n("youtube")._dropDown(t,e,function(e){t.insertText("[youtube]"+e+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};t.commands=e.extend(true,{},r,t.commands)};r=function(){e.each(t.bbcodes,function(n){if(t.bbcodes[n].tags)e.each(t.bbcodes[n].tags,function(e,r){var i=t.bbcodes[n].isInline===false;l[e]=l[e]||{};l[e][i]=l[e][i]||{};l[e][i][n]=r});if(t.bbcodes[n].styles)e.each(t.bbcodes[n].styles,function(e,r){var i=t.bbcodes[n].isInline===false;c[i]=c[i]||{};c[i][e]=c[i][e]||{};c[i][e][n]=r})})};u=function(t,n){var r,i,s,o,u,a=t.style;if(!a)return null;if(!p[n])p[n]=e.camelCase(n);u=p[n];if("text-align"===n){r=e(t);s=a.direction;o=a[u]||r.css(n);if(r.parent().css(n)!==o&&r.css("display")==="block"&&!r.is("hr")&&!r.is("th"))i=o;if(s&&i&&(/right/i.test(i)&&s==="rtl"||/left/i.test(i)&&s==="ltr"))return null;return i}return a[u]};i=function(n,r,i){var s;i=!!i;if(!c[i])return r;e.each(c[i],function(i,a){s=u(n[0],i);if(!s||u(n.parent()[0],i)===s)return;e.each(a,function(i,u){if(!u||e.inArray(s.toString(),u)>-1){if(e.isFunction(t.bbcodes[i].format))r=t.bbcodes[i].format.call(t,n,r);else r=o(t.bbcodes[i].format,r)}})});return r};s=function(n,r,i){var s,u=n[0],a=u.nodeName.toLowerCase();i=!!i;if(l[a]&&l[a][i]){e.each(l[a][i],function(i,u){if(u){s=false;e.each(u,function(t,r){if(!n.attr(t)||r&&e.inArray(n.attr(t),r)<0)return;s=true;return false});if(!s)return}if(e.isFunction(t.bbcodes[i].format))r=t.bbcodes[i].format.call(t,n,r);else r=o(t.bbcodes[i].format,r)})}if(i&&(!e.sceditor.dom.isInline(u,true)||a==="br")){var f=u.parentNode,c=f.lastChild,h=u.previousSibling,p=e.sceditor.dom.isInline(f,true);while(h&&e(h).hasClass("sceditor-ignore"))h=h.previousSibling;while(e(c).hasClass("sceditor-ignore"))c=c.previousSibling;if(p||c!==u||a==="li"||a==="br"&&e.sceditor.ie)r+="\n";if("br"!==a&&h&&h.nodeName.toLowerCase()!=="br"&&e.sceditor.dom.isInline(h,true))r="\n"+r}return r};t.signalToSource=function(r,i){var s,o,u=new e.sceditor.BBCodeParser(t.opts.parserOptions);if(!i){if(typeof r==="string"){s=e("<div />").css("visibility","hidden").appendTo(n.body).html(r);i=s}else i=e(r)}if(!i||!i.jquery)return"";e.sceditor.dom.removeWhiteSpace(i[0]);o=t.elementToBbcode(i);if(s)s.remove();o=u.toBBCode(o,true);if(t.opts.bbcodeTrim)o=e.trim(o);return o};t.elementToBbcode=function(t){return function n(t,r){var o="";e.sceditor.dom.traverse(t,function(t){var u=e(t),a="",f=t.nodeType,l=t.nodeName.toLowerCase(),c=h[l],p=t.firstChild,d=true;if(typeof r==="object"){d=e.inArray(l,r)>-1;if(u.is("img")&&u.data("sceditor-emoticon"))d=true;if(!d)c=r}if(f!==3&&f!==1)return;if(f===1){if(u.hasClass("sceditor-ignore"))return;if(u.hasClass("sceditor-nlf")){if(!p||!e.sceditor.ie&&t.childNodes.length===1&&/br/i.test(p.nodeName)){return}}if(l!=="iframe")a=n(t,c);if(d){if(l!=="code"){a=i(u,a);a=s(u,a);a=i(u,a,true)}o+=s(u,a,true)}else o+=a}else if(t.wholeText&&(!t.previousSibling||t.previousSibling.nodeType!==3)){if(u.parents("code").length===0)o+=t.wholeText.replace(/ +/g," ");else o+=t.wholeText}else if(!t.wholeText)o+=t.nodeValue},false,true);return o}(t[0])};t.signalToWysiwyg=function(n,r){var i=new e.sceditor.BBCodeParser(t.opts.parserOptions),s=i.toHTML(t.opts.bbcodeTrim?e.trim(n):n);return r?f(s):s};f=function(t){var r,i,s,o=e("<div />").hide().appendTo(n.body),u=o[0];s=function(t,r){if(e.sceditor.dom.hasStyling(t))return;if(e.sceditor.ie||t.childNodes.length!==1||!e(t.firstChild).is("br")){while(i=t.firstChild)u.insertBefore(i,t)}if(r){var s=u.lastChild;if(t!==s&&e(s).is("div")&&t.nextSibling===s)u.insertBefore(n.createElement("br"),t)}u.removeChild(t)};u.innerHTML=t.replace(/<\/div>\n/g,"</div>");if((r=u.firstChild)&&e(r).is("div"))s(r,true);if((r=u.lastChild)&&e(r).is("div"))s(r);u=u.innerHTML;o.remove();return u}};e.sceditor.plugins.bbcode.stripQuotes=function(e){return e?e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):e};e.sceditor.plugins.bbcode.formatString=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n-0+1]!=="undefined"?e[n-0+1]:"{"+n+"}"})};var r=e.sceditor.plugins.bbcode.normaliseColour=function(e){var t,n;n=function(e){e=parseInt(e,10);if(isNaN(e))return"00";e=Math.max(0,Math.min(e,255)).toString(16);return e.length<2?"0"+e:e};e=e||"#000";if(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))return"#"+n(t[1])+n(t[2]-0)+n(t[3]-0);if(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))return"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];return e};e.sceditor.plugins.bbcode.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n;if(e[0].nodeName.toLowerCase()!=="font"||!(n=e.attr("face")))n=e.css("font-family");return"[font="+this.stripQuotes(n)+"]"+t+"[/font]"},html:function(e,t,n){return'<font face="'+t.defaultattr+'">'+n+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.attr("size"),r=1;if(!n)n=e.css("fontSize");if(n.indexOf("px")>-1){n=n.replace("px","")-0;if(n>12)r=2;if(n>15)r=3;if(n>17)r=4;if(n>23)r=5;if(n>31)r=6;if(n>47)r=7}else r=n;return"[size="+r+"]"+t+"[/size]"},html:function(e,t,n){return'<font size="'+t.defaultattr+'">'+n+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n,i=e[0];if(i.nodeName.toLowerCase()!=="font"||!(n=e.attr("color")))n=i.style.color||e.css("color");return"[color="+r(n)+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+r(t.defaultattr)+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:true,isInline:false,skipLastLineBreak:true,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:true,isInline:false,skipLastLineBreak:true,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:true,isInline:false,skipLastLineBreak:true,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:false,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:false,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:false,isHtmlInline:true,skipLastLineBreak:true,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:false,skipLastLineBreak:true,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:true,isInline:false,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:true,isInline:false,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:true,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return e.data("sceditor-emoticon")+t},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:true,isSelfClosing:true,isInline:false,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:true,tags:{img:{src:null}},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n,r,i="",s=e[0],o=function(e){return s.style?s.style[e]:null};if(e.attr("data-sceditor-emoticon"))return t;n=e.attr("width")||o("width");r=e.attr("height")||o("height");if(s.complete&&(n||r)||n&&r)i="="+e.width()+"x"+e.height();return"[img"+i+"]"+e.attr("src")+"[/img]"},html:function(e,t,n){var r,i="";if(typeof t.width!=="undefined")i+=' width="'+t.width+'"';if(typeof t.height!=="undefined")i+=' height="'+t.height+'"';if(t.defaultattr){r=t.defaultattr.split(/x/i);i=' width="'+r[0]+'"'+' height="'+(r.length===2?r[1]:r[0])+'"'}return"<img"+i+' src="'+n+'" />'}},url:{allowsEmpty:true,tags:{a:{href:null}},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n=e.attr("href");if(n.substr(0,7)==="mailto:")return'[email="'+n.substr(7)+'"]'+t+"[/email]";return"[url="+decodeURI(n)+"]"+t+"[/url]"},html:function(e,t,n){return'<a href="'+encodeURI(t.defaultattr||n)+'">'+n+"</a>"}},email:{quoteType:e.sceditor.BBCodeParser.QuoteType.never,html:function(e,t,n){return'<a href="mailto:'+(t.defaultattr||n)+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:false,quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(t,n){var r="",i=e(t),s=i.children("cite").first();if(s.length===1||i.data("author")){r=s.text()||i.data("author");i.data("author",r);s.remove();n=this.elementToBbcode(e(t));r="="+r;i.prepend(s)}return"[quote"+r+"]"+n+"[/quote]"},html:function(e,t,n){if(t.defaultattr)n="<cite>"+t.defaultattr+"</cite>"+n;return"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isInline:false,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:false,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:false,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:false,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:false,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:true,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){e=e.attr("data-youtube-id");return e?"[youtube]"+e+"[/youtube]":t},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque'+'" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}};e.sceditor.plugins.bbcode.bbcode={get:function(t){return e.sceditor.plugins.bbcode.bbcodes[t]||null},set:function(t,n){if(!t||!n)return false;n=e.extend(e.sceditor.plugins.bbcode.bbcodes[t]||{},n);n.remove=function(){e.sceditor.plugins.bbcode.bbcode.remove(t)};e.sceditor.plugins.bbcode.bbcodes[t]=n;return this},rename:function(e,t){if(this.hasOwnProperty(e)){this[t]=this[e];this.remove(e)}else return false;return this},remove:function(t){if(e.sceditor.plugins.bbcode.bbcodes[t])delete e.sceditor.plugins.bbcode.bbcodes[t];return this}};e.fn.sceditorBBCodePlugin=function(t){t=t||{};if(e.isPlainObject(t))t.plugins=(t.plugins?t.plugins:"")+"bbcode";return this.sceditor(t)}})(jQuery,window,document)
